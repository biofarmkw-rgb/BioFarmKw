{%- doc -%}
  Facets Horizontal

  @description
  Renders a horizontal product filter bar for collections. Supports filtering, sorting, and layout switching.

  @param {string} id - Unique identifier
  @param {object} results - Filter results object
  @param {number} active_count - Number of active items
  @param {string} filter_type - Filter type, options: Horizontal|Vertical|Drawer
  @param {boolean} [enable_filtering] - Enable filtering feature
  @param {boolean} [enable_sorting] - Enable sorting feature
  @param {boolean} [enable_layout_switch] - Enable layout switch feature
  @param {string} [default_layout] - Default layout, options: grid|list, default grid

  @example
  {% render 'facets-horizontal', id: 'product-facets', results: results, active_count: 3, filter_type: 'horizontal', enable_filtering: true, enable_sorting: true, enable_layout_switch: true, default_layout: 'grid' %}
{%- enddoc -%}

{%- liquid
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: results.sort_by
  endif

  if default_layout == null
    assign default_layout = 'grid'
  endif
-%}

{%- unless results.filters == blank -%}
  <facet-filters-form class="facets">
    <form>
      {% comment %} Keyword {% endcomment %}
      {%- if results.terms -%}
        <input type="hidden" name="q" value="{{ results.terms | escape }}">
        <input name="options[prefix]" type="hidden" value="last">
      {%- endif -%}
      {% if results.current_vendor or results.current_type %}
        <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
      {% endif %}
      <div id="Facet-Horizontal-Wrapper" class="facet-wrapper facet-horizontal-wrapper">
        <div class="facets-main{% if enable_layout_switch %} has-layout-switch{% endif %}">
          {%- if enable_filtering or enable_sorting -%}
            <modal-opener
              role="button"
              class="facets-drawer-button button button--border button--small{% unless filter_type == 'drawer' %} large-up-hide{% endunless %}"
              aria-haspopup="dialog"
              aria-expanded="false"
              aria-controls="Facets-Drawer"
              tabindex="0"
            >
              {% render 'icon-sets-basic', icon: 'filter' %}
              <span>{{ 'products.facets.filters' | t }}</span>
              {%- if active_count > 0 -%}
                <span aria-hidden="true">{{ active_count }}</span>
                <span class="visually-hidden">
                  {{- 'products.facets.filters_selected' | t: count: active_count -}}
                </span>
              {%- endif -%}
            </modal-opener>
          {% endif %}

          {%- if filter_type == 'vertical' and enable_filtering -%}
            <vertical-visibility-switch
              type="button"
              class="vertical-visibility-toggle-button button button--border button--small small-hide medium-hide"
              aria-controls="Facets-Vertical"
              aria-expanded="true"
              tabindex="0"
            >
              {% render 'filter-toggle-svg' %}
              {{ 'products.facets.filters' | t }}
            </vertical-visibility-switch>
          {%- endif -%}

          {%- if enable_filtering and filter_type == 'horizontal' -%}
            <div
              id="Filter-Horizontal-Area"
              class="facet-filtering small-hide medium-hide"
            >
              {%- for filter in results.filters -%}
                {%- case filter.type -%}
                  {%- when 'boolean', 'list' -%}
                    <drop-menu
                      class="facet-item"
                      data-area="#Filter-Horizontal-Area"
                      data-index="{{ forloop.index }}"
                    >
                      <details class="details-disclosure" data-constrain>
                        <summary class="facets-summary">
                          {% liquid
                            assign swatch_value = blank

                            for value in filter.values
                              if value.swatch != blank
                                assign swatch_value = value
                                break
                              endif
                            endfor
                          %}
                          {%- if swatch_value != blank -%}
                            <span
                              class="facet-media media media--square"
                              style="background: {{ swatch_value.swatch.color }};"
                            >
                              {%- if swatch_value.swatch.image != blank -%}
                                {{ swatch_value.swatch.image | image_url: width: 100 | image_tag: loading: 'lazy' }}
                              {%- endif -%}
                            </span>
                          {%- endif -%}

                          <span class="facet-name">{{- filter.label | escape }}</span>
                          {% render 'icon-sets-basic', icon: 'caret-down', class: 'caret-icon' %}
                        </summary>
                        <div
                          class="facet-display details-disclosure-content color-{{ settings.main_color_scheme }} gradient"
                          tabindex="-1"
                        >
                          <div class="facet-display-header">
                            <span class="facets-selected">
                              {{- 'products.facets.filters_selected' | t: count: filter.active_values.size -}}
                            </span>
                            <facet-remove>
                              <a
                                href="{{ filter.url_to_remove }}"
                                class="facet-reset link link-text show-underline light"
                              >
                                {{ 'products.facets.reset' | t }}
                              </a>
                            </facet-remove>
                          </div>
                          <fieldset class="facet-display-content" aria-label="{{ filter.label | escape }}">
                            <expandable-container
                              id="Expandable-Horizontal-Filter-{{ forloop.index }}"
                              data-limit-height
                              style="--limit-height: 15rem"
                            >
                              <ul class="content-main list-unstyled{% if filter.presentation != false %} list-type-{{ filter.presentation }}{% endif %}">
                                {%- for value in filter.values -%}
                                  <li class="facet-value checkbox">
                                    <label
                                      class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}"
                                      tabindex="0"
                                    >
                                      <input
                                        id="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}"
                                        type="checkbox"
                                        name="{{ value.param_name }}"
                                        value="{{ value.value }}"
                                        {% if value.active %}
                                          checked
                                        {% endif %}
                                        {% if value.count == 0 and value.active == false %}
                                          disabled
                                        {% endif %}
                                      >
                                      <span class="input-face">
                                        <span
                                          {% if value.swatch != blank %}
                                            class="media" style="background: {{ value.swatch.color }};"
                                          {% endif %}
                                        >
                                          {%- if value.swatch.image != blank -%}
                                            {{
                                              value.swatch.image
                                              | image_url: width: 100
                                              | image_tag: loading: 'lazy'
                                            }}
                                          {%- endif -%}
                                        </span>
                                      </span>
                                      <span class="facet-value-name" aria-hidden="true">
                                        {{- value.label | escape -}}
                                      </span>
                                      <span class="facet-value-count" aria-hidden="true">{{ value.count }}</span>
                                      <span class="visually-hidden">
                                        {{- value.label | escape }} (
                                        {{- 'products.facets.product_count_simple' | t: count: value.count -}}
                                        )
                                      </span>
                                    </label>
                                  </li>
                                {%- endfor -%}
                              </ul>
                              <div class="expand-button-wrapper">
                                <button
                                  type="button"
                                  class="expand-button button--clear link link-text show-underline"
                                  aria-controls="Expandable-Horizontal-Filter-{{ forloop.index }}"
                                  aria-expanded="false"
                                >
                                  <span class="read-more-text">
                                    {{ 'general.read_more' | t }}
                                  </span>
                                  <span class="read-less-text hidden">
                                    {{ 'general.read_less' | t }}
                                  </span>
                                </button>
                              </div>
                            </expandable-container>
                          </fieldset>
                        </div>
                      </details>
                    </drop-menu>
                  {%- when 'price_range' -%}
                    {% comment %} 价格筛选 {% endcomment %}
                    <drop-menu
                      class="facet-item"
                      data-area="#Filter-Horizontal-Area"
                      data-index="{{ forloop.index }}"
                    >
                      <details class="details-disclosure" data-constrain>
                        <summary class="facets-summary">
                          <span>{{ localization.country.currency.symbol }}</span>
                          <span class="facet-name">{{ filter.label | escape }}</span>
                          {% render 'icon-sets-basic', icon: 'caret-down', class: 'caret-icon' %}
                        </summary>
                        <div
                          class="facet-display gradient details-disclosure-content color-{{ settings.main_color_scheme }} gradient"
                          tabindex="-1"
                        >
                          <div class="drop-menu-list">
                            <div class="facet-display-header">
                              {%- assign max_price_amount = filter.range_max | money | strip_html | escape -%}
                              <span class="facets-selected">
                                {{- 'products.facets.max_price' | t: price: max_price_amount -}}
                              </span>
                              <facet-remove>
                                <a
                                  href="{{ filter.url_to_remove }}"
                                  class="facet-reset link link-text show-underline light"
                                >
                                  {{ 'products.facets.reset' | t }}
                                </a>
                              </facet-remove>
                            </div>
                            <div class="facet-display-content">
                              {% render 'facets-price-range', id: id, filter: filter %}
                            </div>
                          </div>
                        </div>
                      </details>
                    </drop-menu>
                {%- endcase -%}
              {%- endfor -%}
            </div>
          {%- endif -%}

          {%- if enable_layout_switch -%}
            <content-layout-switch
              class="facet-layout-switch"
              role="radiogroup"
              aria-controls="Product-Grid-Container"
            >
              <span class="light small-hide">{{ 'products.facets.view_as_label' | t }}:</span>
              <button
                type="button"
                class="switch-button button button--icon button--small button--ethereal"
                role="radio"
                {% if default_layout == 'list' %}
                  aria-checked="true"
                {% endif %}
                data-layout="list"
                aria-label="{{ 'products.facets.switch_to_list' | t }}"
                data-toggle="tooltip"
                data-title="{{ 'products.facets.list_layout' | t }}"
              >
                {% render 'icon-sets-basic', icon: 'list' %}
              </button>
              <button
                type="button"
                class="switch-button button button--icon button--small button--ethereal"
                role="radio"
                {% if default_layout == 'grid' %}
                  aria-checked="true"
                {% endif %}
                data-layout="grid"
                aria-label="{{ 'products.facets.switch_to_grid' | t }}"
                data-toggle="tooltip"
                data-title="{{ 'products.facets.grid_layout' | t }}"
              >
                {% render 'icon-sets-basic', icon: 'grid' %}
              </button>
            </content-layout-switch>
          {%- endif -%}

          {%- if enable_sorting -%}
            <div class="facet-sorting small-hide">
              <div class="facet-filters-field">
                <label class="light" for="Sort-By">{{ 'products.facets.sort_by_label' | t }}:</label>
                <div class="select">
                  {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
                  <select
                    id="Sort-By"
                    class="select-select"
                    name="sort_by"
                    aria-describedby="a11y-refresh-page-message"
                  >
                    {%- for option in results.sort_options -%}
                      <option
                        value="{{ option.value | escape }}"
                        {% if option.value == sort_by %}
                          selected="selected"
                        {% endif %}
                      >
                        {{ option.name | escape }}
                      </option>
                    {%- endfor -%}
                  </select>
                  <span class="field-button">
                    {% render 'icon-sets-basic', icon: 'caret-down', class: 'caret-icon' %}
                  </span>
                </div>
              </div>
            </div>
          {%- endif -%}
        </div>
        {%- if enable_filtering and filter_type == 'horizontal' -%}
          <div class="facets-active small-hide gradient">
            {%- if active_count > 0 -%}
              <div class="facets-active-wrapper page-width">
                <div class="facets-active-values">
                  {%- for filter in results.filters -%}
                    {% if filter.type == 'price_range' %}
                      {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                        <facet-remove>
                          <a
                            href="{{ filter.url_to_remove }}"
                            class="active-facet-value link"
                            aria-label="{{ 'products.facets.clear_filter' | t }}"
                          >
                            {%- if filter.min_value.value -%}
                              {{ filter.min_value.value | money }}
                            {%- else -%}
                              {{ 0 | money }}
                            {%- endif %}
                            -
                            {% if filter.max_value.value -%}
                              {{ filter.max_value.value | money }}
                            {%- else -%}
                              {{ filter.range_max | money }}
                            {%- endif -%}
                            {% render 'icon-sets-basic', icon: 'close' %}
                          </a>
                        </facet-remove>
                      {%- endif -%}
                    {%- else -%}
                      {%- for value in filter.active_values -%}
                        <facet-remove>
                          <a href="{{ value.url_to_remove }}" class="active-facet-value link">
                            {%- if value.swatch != blank -%}
                              <span
                                class="active-facet-color media media--square"
                                style="background: {{ value.swatch.color }};"
                              >
                                {%- if value.swatch.image != blank -%}
                                  {{ value.swatch.image | image_url: width: 100 | image_tag: loading: 'lazy' }}
                                {%- endif -%}
                              </span>
                            {%- else -%}
                              {{ filter.label }}:
                            {%- endif -%}
                            {{ value.label | escape }}
                            {% render 'icon-sets-basic', icon: 'close' %}
                          </a>
                        </facet-remove>
                      {%- endfor -%}
                    {% endif %}
                  {%- endfor -%}
                </div>
                <div class="facets-active-count">
                  <span class="count light">
                    {%- if results.results_count -%}
                      {{
                        'templates.search.results_with_count'
                        | t: terms: results.terms, count: results.results_count
                      }}
                    {%- elsif results.products_count == results.all_products_count -%}
                      {{ 'products.facets.product_count_simple' | t: count: results.products_count }}
                    {%- else -%}
                      {{
                        'products.facets.product_count'
                        | t: product_count: results.products_count, count: results.all_products_count
                      }}
                    {%- endif -%}
                  </span>
                  <facet-remove class="clear-all">
                    <a href="{{ results_url }}" class="button button--small">
                      {{ 'products.facets.clear_all' | t }}
                    </a>
                  </facet-remove>
                </div>
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    </form>
  </facet-filters-form>
{%- endunless -%}
